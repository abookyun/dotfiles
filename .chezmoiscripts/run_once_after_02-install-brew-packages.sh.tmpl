#!/bin/bash
# Install Homebrew packages from Brewfile
# This runs once after applying dotfiles

{{- if eq .chezmoi.os "darwin" }}
set -e

echo "Installing Homebrew packages..."

# Check if Homebrew is installed
if ! command -v brew &> /dev/null; then
    echo "Homebrew is not installed"
    echo "Installing Homebrew for you."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    echo "Homebrew installed!"
fi

# Check if Brewfile exists
BREWFILE="${XDG_CONFIG_HOME:-$HOME/.config}/homebrew/Brewfile"
if [ ! -f "$BREWFILE" ]; then
    echo "Error: Brewfile not found at $BREWFILE"
    exit 1
fi

# Run brew bundle
echo "Running: brew bundle --file=$BREWFILE"
brew bundle --file="$BREWFILE"

echo "âœ“ Homebrew packages installed"
{{- else }}
echo "Skipping Homebrew installation (not macOS)"
{{- end }}
